<!DOCTYPE html>
<html>
  <head>
    <title>TinyVMI Documentation</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="generator" content="Hugo 0.41-DEV" />
<title>Quick Start with Linux Guest :: TinyVMI Documentation</title>
<link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link href="/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/nucleus.css" rel="stylesheet">
<link href="/theme-flex/style.css" rel="stylesheet">

<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery-2.x.min.js"></script>
<script type="text/javascript">
      var baseurl = "https:\/\/tinyvmi.github.io\/";
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-79101-13', 'auto');
  ga('send', 'pageview');

</script>

    
  </head>
  <body data-url="/quick-start-linux/">
    
      <header>
  <div class="logo">
    
	
  
    <a class="baselink" href="https://tinyvmi.github.io/">TinyVMI Documentation</a>
  

  </div>
  <div class="burger"><a href="javascript:void(0);" style="font-size:15px;">&#9776;</a></div>
    <nav class="shortcuts">
            <li class="" role="">
                <a href="https://github.com/tinyvmi/tinyvmi"  rel="noopener">
                  <i class='fa fa-github'></i> <label>Github repo</label>
                </a>
            </li>
            <li class="" role="">
                <a href="https://tinyvmi.github.io/gsoc-blog"  rel="noopener">
                  <i class='fa fa-bookmark'></i> <label>GSoC 2018 Blog</label>
                </a>
            </li>
    </nav>
</header>
<article>
  <aside>
    <ul class="menu">
          <li data-nav-id="/" class="dd-item">
          <a href="/">
            <i class="fa fa-fw fa-home"></i>
          </a>
          </li>
    <li data-nav-id="/quick-start-windows/" class="dd-item alwaysopen
        ">
      <div>
      <a href="/quick-start-windows/">Quick Start with Windows Guest</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/quick-start-linux/" class="dd-item parent active alwaysopen
        ">
      <div>
      <a href="/quick-start-linux/">Quick Start with Linux Guest</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/step-by-step/" class="dd-item alwaysopen haschildren
        ">
      <div>
      <a href="/step-by-step/">Step by Step</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/step-by-step/install-xen-with-flask/" class="dd-item">
        <div>
          <a href="/step-by-step/install-xen-with-flask/">
            Install Xen With XSM FLASK Policy
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
    <li data-nav-id="/step-by-step/configuration/" class="dd-item alwaysopen haschildren
        ">
      <div>
      <a href="/step-by-step/configuration/">Configure TinyVMI</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/step-by-step/configuration/update-xsm-flask-policy/" class="dd-item">
        <div>
          <a href="/step-by-step/configuration/update-xsm-flask-policy/">
            Update XSM FLASK Policy
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/step-by-step/configuration/update-stubdom-makefile/" class="dd-item">
        <div>
          <a href="/step-by-step/configuration/update-stubdom-makefile/">
            Update Stubdom Makefile
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/step-by-step/configuration/update-minios-makefile/" class="dd-item">
        <div>
          <a href="/step-by-step/configuration/update-minios-makefile/">
            Update Mini-OS Makefile
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/step-by-step/configuration/get-target-guest-info-linux/" class="dd-item">
        <div>
          <a href="/step-by-step/configuration/get-target-guest-info-linux/">
            Get Target Guest Info (Linux)
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/step-by-step/configuration/configure-tinyvmi-with-target-guest-info/" class="dd-item">
        <div>
          <a href="/step-by-step/configuration/configure-tinyvmi-with-target-guest-info/">
            Configure TinyVMI with Target Info
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
      <li data-nav-id="/step-by-step/run-tinyvmi/" class="dd-item">
        <div>
          <a href="/step-by-step/run-tinyvmi/">
            Build and Run TinyVMI
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>




    </ul>
    <section><center>

<a class="github-button" href="https://github.com/tinyvmi/tinyvmi/archive/master.zip" data-icon="octicon-cloud-download" aria-label="Download vjeantet/hugo-theme-docdock on GitHub">Download</a>


<a class="github-button" href="https://github.com/tinyvmi/tinyvmi" data-icon="octicon-star" data-show-count="false" aria-label="Star vjeantet/hugo-theme-docdock on GitHub">Star</a>


<a class="github-button" href="https://github.com/tinyvmi/tinyvmi/fork" data-icon="octicon-repo-forked" data-show-count="true" aria-label="Fork vjeantet/hugo-theme-docdock on GitHub">Fork</a>

</center>

<script async defer src="https://buttons.github.io/buttons.js"></script>
    </section>
  </aside>
  <section class="page">
    
    <div class="nav-select">
      <center>Navigation : 
        <select onchange="javascript:location.href = this.value;">
          
    <option value="/quick-start-windows/" >
   Quick Start with Windows Guest</option> 
  
    <option value="/quick-start-linux/"  selected>
   Quick Start with Linux Guest</option> 
  
    <option value="/step-by-step/" >
   Step by Step</option> 
      <option value="/step-by-step/install-xen-with-flask/" >- Install Xen With XSM FLASK Policy</option>
    <option value="/step-by-step/configuration/" >
  - 
   Configure TinyVMI</option> 
      <option value="/step-by-step/configuration/update-xsm-flask-policy/" >-- Update XSM FLASK Policy</option>
      <option value="/step-by-step/configuration/update-stubdom-makefile/" >-- Update Stubdom Makefile</option>
      <option value="/step-by-step/configuration/update-minios-makefile/" >-- Update Mini-OS Makefile</option>
      <option value="/step-by-step/configuration/get-target-guest-info-linux/" >-- Get Target Guest Info (Linux)</option>
      <option value="/step-by-step/configuration/configure-tinyvmi-with-target-guest-info/" >-- Configure TinyVMI with Target Info</option>
  
      <option value="/step-by-step/run-tinyvmi/" >- Build and Run TinyVMI</option>
  



        </select>
      </center>
    </div>
      <div>
        <div class="searchbox">
          <input data-search-input id="search-by" type="text" placeholder="Search...">
        </div>
        <script type="text/javascript" src="/js/lunr.min.js"></script>
        <script type="text/javascript" src="/js/auto-complete.js"></script>
        <link href="/css/auto-complete.css" rel="stylesheet">
        <script type="text/javascript">
          
              var baseurl = "https:\/\/tinyvmi.github.io\/";
          
        </script>
        <script type="text/javascript" src="/js/search.js"></script>
      </div>
    

    <h1>Quick Start with Linux Guest</h1>
    
    
    



<div class="panel panel-success">
	<div class="panel-heading">NOTE</div>
	<div class="panel-body"><p>This post shows all the comands and configuration files you need to build and run TinyVMI with Linux guest.
Most of them can be used directly in your terminal (tested under Ubuntu 18.04), while some fields need to be adjusted according to your build environment.
For example, your working directory <strong>WORKDIR</strong>, logical volume group name <strong>vg0</strong>, iso image file path, etc.</p>

<p>Acknowledgment:
This post is customized for TinyVMI based on instructions at <a href="https://drakvuf.com/">DRAKVUF</a>.</p>
</div>
	
</div>


<h4 id="1-install-xen">1. Install Xen</h4>

<p>Compile and install Xen from given source code of xen-4.10.0, with XSM enabled. If already installed, go to <a href="#install_guest">Install Guest VM</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mkdir WOKRDIR
cd WORKDIR/
<span style="color:#75715e"># install prerequest for Ubuntu
</span><span style="color:#75715e"></span>wget https://gist.githubusercontent.com/cnlelema/5f14675364a47c6ffa7e34bb6d3ad470/raw/41cffdbc8d0c689e8d9ba78d886a215125d833d9/install-pre-ubu18-xen4.10.0.sh
sudo bash install-pre-ubu18-xen4.10.0.sh

<span style="color:#75715e"># download Xen source
</span><span style="color:#75715e"></span>git clone --recurse-submodules https://github.com/tinyvmi/xen.git
cd xen


<span style="color:#75715e"># configure xen
</span><span style="color:#75715e"></span>./configure --enable-stubdom --enable-systemd

<span style="color:#75715e"># enable XSM support
</span><span style="color:#75715e"></span>make -C xen menuconfig
<span style="color:#75715e"># Mark option 
</span><span style="color:#75715e">#   &#39;Common Features -&gt; Xen Security Modules support&#39;, and 
</span><span style="color:#75715e">#   suboption &#39;Compile Xen with a built-in security policy&#39;. 
</span><span style="color:#75715e"># leave other option as is.
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># compile &amp; install Xen
</span><span style="color:#75715e"></span>make dist -jN  <span style="color:#75715e">#set N to be number of cores/threads on your machine.
</span><span style="color:#75715e"></span>sudo make install 

sudo systemctl enable xen-qemu-dom0-disk-backend.service
sudo systemctl enable xen-init-dom0.service
sudo systemctl enable xenconsoled.service

sudo ldconfig

<span style="color:#75715e"># enable XSM flask in grub entry options
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># backup 
</span><span style="color:#75715e"></span>sudo cp /etc/default/grub /etc/default/grub-backup

<span style="color:#75715e"># Add the following line to the file /etc/default/grub:
</span><span style="color:#75715e">#     GRUB_CMDLINE_XEN_DEFAULT=&#34;dom0_mem=3096M,max:3096M flask=enforcing&#34;
</span><span style="color:#75715e"># This will be appended to the option of Linux kernel in the grub entry
</span><span style="color:#75715e"></span>sudo sed -i <span style="color:#e6db74">&#39;/GRUB_CMDLINE_LINUX=/aGRUB_CMDLINE_XEN_DEFAULT=\&#34;dom0_mem=3096M,max:3096M flask=enforcing\&#34;&#39;</span> /etc/default/grub

sudo update-grub

<span style="color:#75715e"># Finally reboot and choose Xen entry upon grub menu
</span><span style="color:#75715e"></span>sudo reboot</code></pre></div>
<p>Select Xen to boot upon grub entry. After login, you can verify installation via:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">sudo xl list -Z</code></pre></div>
<p>The output should looks like:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"> 
Name                                        ID   Mem VCPUs	State	Time<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>   Security Label
Domain-0                                     <span style="color:#ae81ff">0</span> <span style="color:#ae81ff">10240</span>     <span style="color:#ae81ff">4</span>     r-----     <span style="color:#ae81ff">800</span>.2 system_u:system_r:dom0_t</code></pre></div>
<h4 id="install_guest">2. Install Linux VM and get Linux symbols.</h4>

<p>You can either create a <a href="/quick-start-windows/#install_guest">Windows VM</a> or <a href="/quick-start-linux/#install_guest">Linux VM</a> as target VM to intropect from TinyVMI.</p>

<h5 id="linux-vm">Install Linux as guest VM</h5>

<p>Create logical volumn for Linux VM:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># create logical volumn
</span><span style="color:#75715e">#   with 
</span><span style="color:#75715e">#   size 20G, name &#39;lvxenubu16&#39;, in volumn group &#39;vg0&#39;
</span><span style="color:#75715e"></span>sudo lvcreate -L20G -n lvxenubu16 vg0
<span style="color:#75715e"># verify the lv with its name and size
</span><span style="color:#75715e"></span>sudo lvdisplay
<span style="color:#75715e"># outputs should include
</span><span style="color:#75715e"></span>    --- Logical volume ---
    LV Path                /dev/vg0/lvxenubu16
    LV Name                lvxenubu16
    VG Name                vg0
    LV UUID                iYpFmx-****-****-****-****-****-EmVmgM
    LV Write Access        read/write
    LV Creation host, time ruisrv, <span style="color:#ae81ff">2017</span>-01-24 <span style="color:#ae81ff">14</span>:58:54 -0500
    LV Status              available
    <span style="color:#75715e"># open                 0
</span><span style="color:#75715e"></span>    LV Size                <span style="color:#ae81ff">20</span>.00 GiB
    Current LE             <span style="color:#ae81ff">5120</span>
    Segments               <span style="color:#ae81ff">1</span>
    Allocation             inherit
    Read ahead sectors     auto
    - currently set to     <span style="color:#ae81ff">256</span>
    Block device           <span style="color:#ae81ff">252</span>:5</code></pre></div>
<p>Create a configuration file use the following template:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-conf" data-lang="conf"># file ubuntu16.cfg
# ====
# HVM guest created from Windows ISO file
# ====

type = &#34;hvm&#34;
serial=&#39;pty&#39;

# Guest name
name = &#34;xen16a&#34;


# Initial memory allocation (MB)
memory = 4096

# Maximum memory (MB)
maxmem = 4096

# Number of VCPUS
vcpus = 2

# Network devices
vif = [ &#39;ip=10.0.0.2,bridge=netbr0&#39; ]

# Disk Devices
# change to your lv path and iso file.
disk = [ &#39;/dev/vg0/lvxenubu16,raw,xvda,w&#39;,&#39;/media/iso/ubuntu-16.04-desktop-amd64.iso,,hdc,cdrom&#39; ]

# Guest VGA console configuration, either SDL or VNC
#sdl = 1
vnc = 1

vncconsole=1

boot = &#34;dc&#34;
# uncomment this after installation, to avoid boot to iso
#boot = &#34;cd&#34;

# fix mouse cursor
usbdevice=&#39;tablet&#39;

# XSM label
seclabel=&#39;system_u:system_r:domU_t&#39;</code></pre></div>
<p>Start VM to install Ubuntu 16.04:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">xl create ubuntu16.cfg</code></pre></div>
<h5 id="linux-symbol">Setup Linux Symbols</h5>

<p>After installaltion, get Linux kernel symbols and read offsets by running offset finder tool in guest. The offset finder tool is from the LibVMI.</p>

<p>First mount the logical volumn of the guest VM.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># assume the guest is installed in /dev/vg0/lvxenubu16
</span><span style="color:#75715e"></span>sudo fdisk -l /dev/vg0/lvxenubu16</code></pre></div>
<p>output will show the sector size and start sector of the first partition:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Disk /dev/vg0/lvxenubu16: <span style="color:#ae81ff">20</span> GiB, <span style="color:#ae81ff">21474836480</span> bytes, <span style="color:#ae81ff">41943040</span> sectors
Units: sectors of <span style="color:#ae81ff">1</span> * 512 <span style="color:#f92672">=</span> <span style="color:#ae81ff">512</span> bytes
Sector size <span style="color:#f92672">(</span>logical/physical<span style="color:#f92672">)</span>: <span style="color:#ae81ff">512</span> bytes / <span style="color:#ae81ff">4096</span> bytes
I/O size <span style="color:#f92672">(</span>minimum/optimal<span style="color:#f92672">)</span>: <span style="color:#ae81ff">4096</span> bytes / <span style="color:#ae81ff">4096</span> bytes
Disklabel type: dos
Disk identifier: 0x488fbb03

Device                   Boot    Start      End  Sectors  Size Id Type
/dev/vg0/lvxenubu16p1 *        <span style="color:#ae81ff">2048</span> <span style="color:#ae81ff">39942143</span> <span style="color:#ae81ff">39940096</span>   19G <span style="color:#ae81ff">83</span> Linux
/dev/vg0/lvxenubu16p2      <span style="color:#ae81ff">39942144</span> <span style="color:#ae81ff">41940991</span>  <span style="color:#ae81ff">1998848</span>  976M <span style="color:#ae81ff">82</span> Linux </code></pre></div>
<p>Here we can mount the guest image using offset of start sector (2048) multiplied by sector size (512):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">xl destroy xen16a
xl list
<span style="color:#75715e"># make sure guest is not running
</span><span style="color:#75715e"></span>
mount_offset<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>echo <span style="color:#e6db74">&#34;2048*512&#34;</span> | bc<span style="color:#66d9ef">)</span>
echo $mount_offset

sudo mount -o loop,offset<span style="color:#f92672">=</span>$mount_offset /dev/vg0/lvxenubu16 mnt/

<span style="color:#75715e"># Then copy libvmi/tools/linux-offset-finder to guest VM, and copy system map file to Dom0.
</span><span style="color:#75715e"></span>
sudo cp -r libvmi/tools/linux-offset-finder /mnt/root/

<span style="color:#75715e"># create directory to store system map and configuration files
</span><span style="color:#75715e"># [suggested:] adjust the folder name according to your guest kernel version 
</span><span style="color:#75715e"></span>mkdir example_target_u16_4.4.0_101_x64_test
cp /mnt/boot/System.map-4.4.0-101-generic example_target_u16_4.4.0_101_x64_test/

sudo umount /mnt</code></pre></div>
<p>Then convert system map to C string:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cd example_target_u16_4.4.0_101_x64_test/
xxd -i System.map-4.4.0-101-generic &gt; target_libvmi_sym.c</code></pre></div>
<p>Then, create new file <code>target_libvmi_sym.h</code> with the following code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">// file: target_libvmi_sym.h
</span><span style="color:#75715e"></span><span style="color:#75715e">#ifndef TARGET_LIBVMI_CONF_SYM_H
</span><span style="color:#75715e">#define TARGET_LIBVMI_CONF_SYM_H
</span><span style="color:#75715e"></span>

<span style="color:#75715e">/**
</span><span style="color:#75715e">* define linux_system_map_string for Linux
</span><span style="color:#75715e">* change this if use another system map
</span><span style="color:#75715e">* all the System_map_* variables are declared here, and
</span><span style="color:#75715e">* defined at file /tiny-vmi/config/target_libvmi_sym.c
</span><span style="color:#75715e">* the definition is generated by xxd command which coverts a file
</span><span style="color:#75715e">* to ASCII string codes: xxd -i System_map_*
</span><span style="color:#75715e">*/</span>

<span style="color:#75715e">#define TARGET_SYSMAP
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#define linux_system_map_string System_map_4_4_0_101_generic
</span><span style="color:#75715e">#define linux_system_map_string_len System_map_4_4_0_101_generic_len
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">extern</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">char</span> System_map_4_4_0_101_generic[];
<span style="color:#66d9ef">extern</span> <span style="color:#66d9ef">unsigned</span> <span style="color:#66d9ef">int</span> System_map_4_4_0_101_generic_len;


<span style="color:#75715e">#define linux_system_map_string_SRC_FILE &#34;string&#34;
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#endif // TARGET_LIBVMI_CONF_SYSMAP_H</span></code></pre></div>
<p>Replace variable <code>System_map_4_4_0_101_generic</code> and <code>System_map_4_4_0_101_generic_len</code> as needed.
 You can run <code>head target_libvmi_sym.c</code> and <code>tail target_libvmi_sym.c</code>  to find the names.</p>

<p>Now boot linux, in guest VM, run with root:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">root@guest: $ cd /root/linux-offset-finder/
root@guest: $ make
root@guest: $ insmod findoffsets.ko
root@guest: $ rmmod findoffsets
root@guest: $ dmesg | tail

<span style="color:#75715e"># output should be similar to
</span><span style="color:#75715e"></span><span style="color:#f92672">[</span>  <span style="color:#ae81ff">490</span>.682638<span style="color:#f92672">]</span> findoffsets: module verification failed: signature and/or  required key missing - tainting kernel
<span style="color:#f92672">[</span>  <span style="color:#ae81ff">490</span>.683879<span style="color:#f92672">]</span> Module FindOffsets  loaded.
<span style="color:#f92672">[</span>  <span style="color:#ae81ff">490</span>.683879<span style="color:#f92672">]</span> 
<span style="color:#f92672">[</span>  <span style="color:#ae81ff">490</span>.683891<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>domain name<span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
<span style="color:#f92672">[</span>  <span style="color:#ae81ff">490</span>.683896<span style="color:#f92672">]</span>     ostype <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Linux&#34;</span>;
<span style="color:#f92672">[</span>  <span style="color:#ae81ff">490</span>.683901<span style="color:#f92672">]</span>     sysmap <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;[insert path here]&#34;</span>;
<span style="color:#f92672">[</span>  <span style="color:#ae81ff">490</span>.683907<span style="color:#f92672">]</span>     linux_name <span style="color:#f92672">=</span> 0x600;
<span style="color:#f92672">[</span>  <span style="color:#ae81ff">490</span>.683912<span style="color:#f92672">]</span>     linux_tasks <span style="color:#f92672">=</span> 0x350;
<span style="color:#f92672">[</span>  <span style="color:#ae81ff">490</span>.683917<span style="color:#f92672">]</span>     linux_mm <span style="color:#f92672">=</span> 0x3a0;
<span style="color:#f92672">[</span>  <span style="color:#ae81ff">490</span>.683922<span style="color:#f92672">]</span>     linux_pid <span style="color:#f92672">=</span> 0x448;
<span style="color:#f92672">[</span>  <span style="color:#ae81ff">490</span>.683927<span style="color:#f92672">]</span>     linux_pgd <span style="color:#f92672">=</span> 0x40;
<span style="color:#f92672">[</span>  <span style="color:#ae81ff">490</span>.683931<span style="color:#f92672">]</span> <span style="color:#f92672">}</span></code></pre></div>
<p>Copy the offset output into the WORKDIR/example_target_u16_4.4.0_101_x64_test/libvmi.conf file in dom0, be sure to update the domain name:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-conf" data-lang="conf"># file example_target_u16_4.4.0_101_x64_test/libvmi.conf 
xen16a{
   ostype = &#34;Linux&#34;;
   sysmap = &#34;string&#34;;
   linux_name = 0x600;
   linux_tasks = 0x350;
   linux_mm = 0x3a0;
   linux_pid = 0x448;
   linux_pgd = 0x40;
}</code></pre></div>
<p>Next, convert the configuration file into C string.</p>

<pre><code>cd example_target_u16_4.4.0_101_x64_test/
xxd -i libvmi.conf &gt; target_libvmi_conf_file.c
</code></pre>

<p>Then mv the configuration files to TinyVMI and create symblic link in TinyVMI source:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mv example_target_u16_4.4.0_101_x64_test/ xen/stubdom/tinyvmi/tiny-vmi/config/target_conf_examples/
<span style="color:#75715e"># go to dir WORKDIR/xen/stubdom/tinyvmi/tiny-vmi/config/target_conf 
</span><span style="color:#75715e"># and remove old links
</span><span style="color:#75715e"></span>cd xen/stubdom/tinyvmi/tiny-vmi/config/target_conf/
rm *
<span style="color:#75715e"># create symbolic 
</span><span style="color:#75715e"></span>ln -s ../target_conf_examples/example_target_u16_4.4.0_101_x64_test/* .</code></pre></div>
<p>Update <code>DOMAIN_NAME</code> in file <code>xen/stubdom/tinyvmi/include/domain_id.h</code>. For example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c" data-lang="c"><span style="color:#75715e">#ifndef DOMAIN_ID_H
</span><span style="color:#75715e">#define DOMAIN_ID_H
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#define DOMAIN_NAME &#34;xen16a&#34;
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#endif // DOMAIN_ID_H</span></code></pre></div>
<h4 id="run-tinyvmi">3. Compile and run TinyVMI</h4>

<p>Now we are ready to compile and run TinyVMI</p>

<p>Adjust the Xen configuration file use the template at <code>WORKDIR/xen/stubdom/tinyvmi/domain_config</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-conf" data-lang="conf"># file xen-src/stubdom/tinyvmi/domain_config
# Change fileds accordingly

# Kernel image file.
kernel = &#34;mini-os.gz&#34;

# Initial memory allocation (in megabytes) for the new domain.
memory = 64

# A name for your domain. All domains must have different names.
name = &#34;TinyVMI&#34;

# network connection
vif = [&#39;ip=10.0.0.100,bridge=netbr0&#39; ]

on_crash = &#39;destroy&#39;

seclabel=&#39;system_u:system_r:domU_t&#39;</code></pre></div>
<p>You might need to adjust the network configuration accordingly, i.e. giving a valid IP address and network bridge name on your domain 0.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">cd WORKDIR/xen/stubdom/tinyvmi
sudo bash run.tiny.sh buildrun</code></pre></div>
<p>Then you&rsquo;ll get outputs like:</p>

<pre><code>Xen Minimal OS!
    start_info: 0xf6000(VA)
    nr_pages: 0x2000
    shared_inf: 0xa0278000(MA)
        pt_base: 0xf9000(VA)

....

[main] IP 0 netmask 0 gateway 0.
[main] TCP/IP bringup begins.
Thread &quot;tcpip_thread&quot;: pointer: 0x0x200000002170, stack: 0x0x2f0000
[tcpip_thread] TCP/IP bringup ends.
[main] Network is ready.
&quot;main&quot; 
VMI_TEST: Hello, world!
VMI_TEST: main: TimeStamp: 1531894244 s 473686 us
VMI_TEST: main: TimeStamp: 1531894246 s 483747 us
evtchn_open() -&gt; 4
xenevtchn_bind_interdomain(1, 6) = 0
VMI_TEST: LibVMI init succeeded!
VMI_TEST: Waiting for events...
</code></pre>



    
    
        <div class="chevrons">
    <div id="navigation">
<a class="nav nav-prev" href="/quick-start-windows/" title="Quick Start with Windows Guest"> <i class="fa fa-chevron-left"></i><label>Quick Start with Windows Guest</label></a>
    <a class="nav nav-next" href="/step-by-step/" title="Step by Step" style="margin-right: 0px;"><label>Step by Step</label><i class="fa fa-chevron-right"></i></a></div>
  </div>

  </section>
</article>

<footer>

<div class="footline">
    

    

  
    <div class="date">
        <i class='fa fa-calendar'></i> Last update on 08/05/2018
    </div>
    

    <div class="github-link">
      <a href="https://github.com/tinyvmi/tinyvmi-docs-hugo/edit/master/content/quick-start-linux/_index.md" target="blank"><i class="fa fa-code-fork"></i>
        Improve this page</a>
    </div>
  </div>


	<div>


  
    
  



	</div>
</footer>

<script src="/js/clipboard.min.js"></script>

<link href="/css/featherlight.min.css" rel="stylesheet">
<script src="/js/featherlight.min.js"></script>



<script src="/theme-flex/script.js"></script>

    

    
    

    
  </body>
</html>